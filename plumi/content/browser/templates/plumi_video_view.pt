<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plumi">

<!-- meta and link tags for facebook integration -->
<tal:block metal:fill-slot="head_slot" 
           condition="python:view.transcoding('mp4')" 
           define="mp4 python:view.transcoding('mp4');
                   portal context/@@plone_portal_state/portal">
    <meta name="medium" content="video" />
    <meta name="title" tal:attributes="content here/title" />
    <meta name="description" tal:attributes="content here/description" />
    <link rel="image_src" tal:condition="view/hasThumbnailImage" tal:attributes="href string:${here/absolute_url}/thumbnailImage_mini" />
    <meta name="video_height" content="300" /> 
    <meta name="video_width" content="400" />
    <meta name="video_type" content="application/x-shockwave-flash" />
    <meta property="og:title" content="title" tal:attributes="content here/title" />
    <meta property="og:description" content="description" tal:attributes="content here/description" />
    <meta property="og:image" content="thumbnail" tal:condition="view/hasThumbnailImage" tal:attributes="content string:${here/absolute_url}/thumbnailImage_mini" />
    <meta name="og:video:height" content="300" /> 
    <meta name="og:video:width" content="400" />

</tal:block>
<head>
    <metal:block fill-slot="column_two_slot" />
</head>
<body>

<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main"
           tal:define="kssClassesView context/@@kss_field_decorator_view;
                       getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                       templateId template/getId;
                       fullDescription here/getFullDescription;
                       is_editable context/@@plone_context_state/is_editable;
                       portal context/@@plone_portal_state/portal;">
		<div class="roundborder rounded">
        <div tal:replace="structure provider:plone.abovecontent" />
        <div tal:replace="structure provider:plone.abovecontenttitle" tal:condition="not:ajax_load" />
        <h1 class="documentFirstHeading"> 
          <metal:field use-macro="python:here.widget('title', mode='view')">
            Title
          </metal:field>
        </h1>

        <div tal:replace="structure provider:plone.belowcontenttitle" />

        <p class="documentDescription">
            <metal:field use-macro="python:here.widget('description', mode='view')">
            Description
            </metal:field>
        </p>


        <p tal:condition="python: not fullDescription and is_editable"
           i18n:translate="no_body_text"
           class="discreet">
            This item does not have any body text, click the edit tab to change it.
        </p>

          <div id="video-core" tal:define="
                                     jpeg python:view.transcoding('jpeg'); 
                                     mp4_high python:view.transcoding('mp4-high'); 
                                     mp4_low python:view.transcoding('mp4-how'); 
                                     webm_high python:view.transcoding('webm-high'); 
                                     webm_low python:view.transcoding('webm-low'); 
				     mp4 python: mp4_high or mp4_low;
				     webm python: webm_high or webm_low;
				     transcoded python: mp4 and webm;
                                     thumb python:view.hasThumbnailImage() and here.absolute_url()+'/thumbnailImage_mini' or '';
                                     fullThumb python:view.hasThumbnailImage() and here.absolute_url()+'/thumbnailImage_preview' or ''">

            <tal:failed_transcode condition="not: transcoded">
              <a id="no-video-player"
                 tal:attributes="href string:$fullThumb">

                <img tal:attributes="src thumb;
                                     alt here/thumbnailImageDescription;
                                     style string:margin-bottom:5px;" />
                <span>
                  <img tal:replace="structure here/search_icon.gif" />
                  <tal:larger i18n:translate="thumbnail_click_to_enlarge">
                    View larger image
                  </tal:larger>
                </span>
              </a>
            </tal:failed_transcode>

               <!--a tal:attributes="href mp4" id="player-videoview" tal:condition="mp4"  >
               </a-->             

             <video id="main-video" controls width="525" height="300" tal:attributes="poster jpeg|string:${here/absolute_url}/thumbnailImage" controls="controls" tal:condition="transcoded">
                <source tal:condition="webm" tal:attributes="src webm" type="video/webm" />
                <source tal:condition="mp4" tal:attributes="src mp4" type="video/mp4" />
                <object width="525" height="300" type="application/x-shockwave-flash" data="++resource++collective.mediaelementjs/flashmediaelement.swf">
                    <param name="movie" value="++resource++collective.mediaelementjs/flashmediaelement.swf" />
                    <param name="flashvars" tal:attributes="value string:controls=true&poster=${thumb}&file=${mp4}" />
                    <!-- Image as a last resort -->
                    <img tal:attributes="src thumb" width="525" height="300" title="No video playback capabilities" />
                </object>
             </video>
               <a tal:attributes="href string:#" id="player-low" tal:condition="webm_high" i18n:translate="slow_connection_low_res">Slow Connection? Try a lower resolution.
               </a>
               <a tal:attributes="href string:#" id="player-high" tal:condition="webm_low" style='display:none;' i18n:translate="click_high_res">Click here to view a higher resolution.

               </a>
            <div tal:omit-tag="" tal:condition="mp4">        
                    <div class="embed" id="embedDiv" i18n:translate="copy_embed_code">
                 Copy the following to embed the movie into another web page:</div>
                    <textarea rows="2" onclick="this.focus();this.select();"><span tal:replace="string:<iframe src='${here/absolute_url}/embed_view' frameborder='0' width='525' height='300'></iframe>" /></textarea>
             </div>
             <script language="javascript">
                var player = new MediaElementPlayer('video');
             </script>
             <script language="JavaScript" tal:content="string:$(function(){
                    $('#player-low').click(function () {
                      jq.cookie('videores', 'low');
                      jq('#player-high')[0].style.display = ''; 
                      jq('#player-low')[0].style.display = 'none';
                      var extension = $('video')[0].currentSrc.split('.')[$('video')[0].currentSrc.split('.').length -1];
                      if (extension == 'webm') {
                          player.setSrc('${webm_low}');
                      } else {
                          player.setSrc('${mp4_low}');
                      }
                      player.play(); 
                      return false
                    });
                });">
             </script>
             <script language="JavaScript" tal:content="string:$(function(){
                    $('#player-high').click(function () {
                      jq.cookie('videores', 'high');
                      jq('#player-high')[0].style.display = 'none';
                      jq('#player-low')[0].style.display = '';
                      var extension = $('video')[0].currentSrc.split('.')[$('video')[0].currentSrc.split('.').length -1];
                      if (extension == 'webm') {
                          player.setSrc('${webm_high}');
                      } else {
                          player.setSrc('${mp4_high}');
                      }
                      player.play(); 
                      return false
                    });
                });">
             </script>
        <div id="video-downloads">
          <p class="download-block"> 
            <a id="download-link"
                tal:attributes="href string:${here/absolute_url}/@@download/video_file/${context/video_file/filename}" i18n:translate="">
              Download Hi-Res / Screening Version
            </a>
            <span class="discreet"
                  tal:define="fsiz here/getObjSize"
                  tal:content="string:($fsiz)" />
          </p>            

          <p class="download-block" tal:condition="view/has_torrent">
           <a id="torrent-link"
             tal:attributes="href string:${here/absolute_url}/@@download_torrent/${context/video_file/filename}">
            Download via BitTorrent
          </a>
          <span tal:condition="view/has_torrent"> (Seeders: <span class="seeders"></span>)</span>
          </p>
            <script>

                function getSeeders() {
                    jq.ajax({
                        url: location.href.split('/view')[0] + '/@@seeders',
                        type: "GET",
                        dataType: "json",
                        timeout: 5000,
                        success: function(data) {
                            jq('span.seeders').html(data);
                            jq('span.seeders').fadeIn();
                        },
                        error: function(){
                        }
                    });
                }

                jq(window).load(function() {getSeeders();});

            </script>

        </div> <!-- id=video-downloads -->
      </div> <!-- id=video-core -->

           <div id="video-infos">
           <div 
                tal:define="duration context/plumiVideoDuration"
                tal:condition="duration">
             <img src="" tal:attributes="src string:clock.gif">
             <span class="discreet" tal:content="duration" /> 
          </div>	
        <dl class="videoitemtop plumi-props-listing plumi-genres"
            tal:define="genres view/genres"
            tal:condition="genres">
          <dt i18n:translate="">Genres</dt>
          <dd>
            <ul>
              <li tal:repeat="genre genres">
                <a href="" title="" id="" tal:condition="python: genre['id'] != 'aaa_none'"
                   tal:attributes="href genre/url|nothing;
                                   id genre/id;
                                   title genre/title;
                                   class string:genre-${genre/id};"
                   tal:content="genre/title" />
              </li>
            </ul>
          </dd>
        </dl>
        
        <dl class="videoitemtop plumi-props-listing plumi-categories"
            tal:define="categories view/categories"
            tal:condition="categories">
          <dt i18n:translate="">Categories</dt>
          <dd>
            <ul>
              <li tal:repeat="cat categories">
                <a href="" title="" id=""
                   tal:attributes="href cat/url|nothing;
                                   id cat/id;
                                   title cat/title;
                                   class string:category-${cat/id};"
                   tal:content="cat/title" />
              </li>
            </ul>
          </dd>
        </dl>

        <dl class="videoitemtop plumi-props-listing plumi-keywords"
            tal:define="subjects view/subjects"
            tal:condition="subjects">
          <dt i18n:translate="">Keywords</dt>
          <dd>
            <ul>
              <li tal:repeat="kw subjects">
                <a href="" title="" id=""
                   tal:attributes="href kw/url;
                                   id kw/id;
                                   title kw/title;
                                   class string:keyword-${kw/id};"
                   tal:content="kw/title" />
              </li>
            </ul>
          </dd>
        </dl>
        
        <dl class="videoitemtop plumi-props-listing plumi-keywords"
            tal:define="country view/country"
            tal:condition="country">
          <dt i18n:translate="">Country</dt>
          <dd>
            <ul>
              <li>
                <a tal:attributes="href country/url|nothing;
                                   class string:country-${country/id}"
                   tal:content="country/title">countryname</a>
              </li>
            </ul>
          </dd>
        </dl>

        <dl class="videoitemtop plumi-props-listing plumi-keywords"
            tal:define="video_language view/video_language"
            tal:condition="video_language">
          <dt i18n:translate="">Language</dt>
          <dd>
            <ul>
              <li>
                <a tal:attributes="href video_language/url|nothing;
                                   class string:video_language-${video_language/id}"
                   tal:content="video_language/title">languagename</a>
              </li>
            </ul>
          </dd>
        </dl>

        <div class="vcard">
          <table summary="Event details" class="vertical listing">
            <thead>
              <tr>
                <th colspan="2" class="nosort" i18n:translate="">
                  Video information
                </th>
              </tr>
            </thead>
            <tbody>
              <tr tal:condition="here/Producer">
                <th i18n:translate="">
                  Produced by
                </th>
                <td tal:content="here/Producer">
                  Producer
                </td>
              </tr>
              <tr tal:condition="here/Director">
                <th i18n:translate="">
                  Directed by
                </th>
                <td tal:content="here/Director">
                  Director
                </td>
              </tr>
              <tr tal:condition="here/VideoLanguage">
                <th i18n:translate="">
                  Video Language
                </th>
                <td tal:content="here/VideoLanguage">
                  Director
                </td>
              </tr>
              <tr tal:condition="here/ProducerEmail"
                  tal:define="emailaddy here/ProducerEmail">
                <th i18n:translate="">Contact</th>
                <td>
                  <a href=""
                     tal:attributes="href string:mailto:$emailaddy" i18n:translate="">
                    write the producer
                  </a>
                </td>
              </tr>
              <tr tal:condition="here/WebsiteURL">
                <th i18n:translate="">Home page</th>
                <td>
                  <a href=""
                     tal:define="url here/WebsiteURL"
                     tal:attributes="href url" 
             i18n:translate="">more info</a>
                </td>
              </tr>
              <tr tal:define="dp view/post_date"
                  tal:condition="dp">
                <th i18n:translate="">Produced</th>
                <td tal:content="dp">
                  date produced.
                </td>
              </tr>

              <tr tal:condition="here/ProductionCompanyName">
                <th i18n:translate="">Production Company</th>
                <td tal:content="here/ProductionCompanyName">
                  production company
                </td>
              </tr>
              <tr tal:condition="here/Distributor">
                <th i18n:translate="">Distributor</th>
                <td tal:content="here/Distributor">
                  Distributor
                </td>
              </tr>

            </tbody>
          </table>
        </div> <!-- class=vcard -->
      </div> <!-- id=video-infos -->

        <div metal:use-macro="here/document_relateditems/macros/relatedItems">
            show related items if they exist
        </div>


		
		<div id="full-description" tal:condition="here/FullDescription">
			<h1 class="documentFirstHeading" i18n:translate="full_description"> 
				Full Description
			</h1>
			<div tal:content="structure here/FullDescription">
				Body text
			</div>
		</div>

      <div id="video-licensing">
      
        <div tal:replace="structure context/@@copyright_byline_view | nothing" />
        <div tal:replace="structure context/@@citation_view | nothing" />
      </div>

	  <div tal:condition="view/transcoding_rights">    
        <script type="text/javascript">
           function showNotification(){
               jq("#notificationDiv").show();
               setTimeout(function(){jq("#notificationDiv").fadeOut(500);},15000)
           }
        </script>
        <div id="video-transcoding" tal:define="transcoding view/transcoding_status">

    	<h1 class="documentFirstHeading" i18n:translate="transcoding"> 
			Transcoding
		</h1>    


          <strong i18n:translate="transcode_status">Transcode Status</strong> 
          <p tal:content="transcoding" />

          <p><span tal:omit-tag="" i18n:translate="restart_transcoding">
            You may like to try to</span>
            <a tal:attributes="href string:${here/absolute_url}/reTranscode"
               onclick="showNotification()"
               >re-start transcoding.</a>              
          </p>
          <div id="notificationDiv">
              <strong>reTranscoding...</strong> <p> Please refresh the page in 5-15 minutes (the larger your video the longer it will take) to see the retranscoded file.</p>
          </div>
        </div> <!-- id=video-transcoding -->
        </div> <!-- transcoding rights tal -->
        
	</div>

<div id="authors_latest" tal:define="other_videos  view/authors_latest|nothing">
    <h1 class="documentFirstHeading" tal:condition="other_videos">Other videos by this author</h1>
<ul>
    <li tal:repeat="video other_videos">
        <h4>
            <a class="video-download" title="View details about this video"
                                        tal:attributes="href string:${video/url}/view;">
                <img title="" alt="" tal:attributes="alt video/video_title;
                                                     src string:${video/url}/thumbnailImage_thumb" />
            </a>
            <span class="featuredItemTitle" href="" tal:content="video/video_title"
                                                 tal:attributes="href string:${video/url}/view;
                                                                 title video/video_title" />
        </h4>
        <p class="discreet">
        Posted on <span tal:replace="video/post_date" />
        </p>
    </li>
</ul>

</div>      
    </tal:main-macro>
    <script type="text/javascript" src="http://s3.www.universalsubtitles.org/js/unisubs-widgetizer.js"></script>
    <script type="text/javascript">
    // Fullscreen video width fix (unisubs/mediaelementjs conflict)
    $('.mejs-fullscreen-button button').live('click',function(){
        $('#main-video').attr('style','');
        if ($(this).parent().hasClass('mejs-unfullscreen')) {
            $('span.unisubs-captionSpan').css('margin-top','auto');
            $('span.unisubs-captionSpan').css('margin-left','40%');
            $('span.unisubs-captionSpan').css('margin-right','auto');
            $('span.unisubs-captionSpan').css('margin-bottom','40px');
        } else {
            $('span.unisubs-captionSpan').css('margin-top','0');
            $('span.unisubs-captionSpan').css('margin-left','0');
        }
    });
    </script>
</metal:main>
</body>
</html>
