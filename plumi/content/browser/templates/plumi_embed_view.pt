<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      i18n:domain="plumi">

<!-- meta and link tags for facebook integration -->

<head>
    <tal:block
               condition="python:view.transcoding('mp4')" 
               define="mp4 python:view.transcoding('mp4')">
        <meta name="medium" content="video" />
        <meta name="title" tal:attributes="content here/title" />
        <meta name="description" tal:attributes="content here/description" />
        <link rel="image_src" tal:condition="view/hasThumbnailImage" tal:attributes="href string:${here/absolute_url}/thumbnailImage_mini" />
        <meta name="video_height" content="300" /> <!-- TODO make these consistent across the board -->
        <meta name="video_width" content="400" />
    </tal:block>
</head>
<body bottommargin="0" leftmargin="0" marginheight="0" marginwidth="0" rightmargin="0" topmargin="0">

<metal:main>
    <tal:main-macro metal:define-macro="main"
           tal:define="kssClassesView context/@@kss_field_decorator_view;
                       getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                       templateId template/getId;
                       fullDescription here/getFullDescription;">
		<div class="roundborder rounded" tal:define="original_url python:here.absolute_url();
                                                     portal context/@@plone_portal_state/portal">

          <div id="video-core" tal:define="transcoded python:view.transcoding('ogg') and view.transcoding('mp4');
                                     webm python:view.transcoding('webm').replace('+','%2B'); 
                                     mp4 python:view.transcoding('mp4').replace('+','%2B'); 
                                     ogg python:view.transcoding('ogg');
                                     thumb python:view.hasThumbnailImage() and here.absolute_url()+'/thumbnailImage_mini' or '';
                                     fullThumb python:view.hasThumbnailImage() and here.absolute_url()+'/thumbnailImage' or ''">

            <tal:failed_transcode condition="not: mp4">
              <a id="no-video-player"
                 tal:attributes="href string:$fullThumb">

                <img tal:attributes="src thumb;
                                        alt here/thumbnailImageDescription;
                                     style string:margin-bottom:5px;" />
                <span>
                  <img tal:replace="structure here/search_icon.gif" />
                  <tal:larger i18n:translate="thumbnail_click_to_enlarge">
                    View larger image
                  </tal:larger>
                </span>
              </a>
            </tal:failed_transcode>        
            
              <video controls width="525" height="300" tal:attributes="poster string:${here/absolute_url}/thumbnailImage" controls="controls" preload="none">
                <source tal:condition="mp4" tal:attributes="src mp4" type="video/mp4" />               
                <source tal:condition="webm" tal:attributes="src webm" type="video/webm" />
                <object width="525" height="300" type="application/x-shockwave-flash" data="++resource++collective.mediaelementjs/flashmediaelement.swf">
                    <param name="movie" value="++resource++collective.mediaelementjs/flashmediaelement.swf" />
                    <param name="flashvars" tal:attributes="value string:controls=true&poster=${thumb}&file=${mp4}" />       
                    <!-- Image as a last resort -->
                    <img tal:attributes="src thumb" width="525" height="300" title="No video playback capabilities" />
                </object>
             </video>
             <script>
                $('video').mediaelementplayer(/* Options */);
             </script>
          </div> <!-- id=video-core -->      
	</div>

    </tal:main-macro>
</metal:main>
</body>
</html>

