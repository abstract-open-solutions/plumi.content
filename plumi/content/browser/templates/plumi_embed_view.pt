<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      i18n:domain="plumi">

<!-- meta and link tags for facebook integration -->

<head>
    <tal:block
               condition="python:view.transcoding('mp4')" 
               define="mp4 python:view.transcoding('mp4')">
        <meta name="medium" content="video" />
        <meta name="title" tal:attributes="content here/title" />
        <meta name="description" tal:attributes="content here/description" />
        <link rel="image_src" tal:condition="view/hasThumbnailImage" tal:attributes="href string:${here/absolute_url}/thumbnailImage_mini" />
        <meta name="video_height" content="300" /> <!-- TODO make these consistent across the board -->
        <meta name="video_width" content="525" />
        <script src="jquery.js" type="text/javascript"></script>
        <script src="++resource++collective.mediaelementjs/mediaelement-and-player.min.js" type="text/javascript"></script>
        <style type="text/css" media="screen">@import url(++resource++collective.mediaelementjs/mediaelementplayer.min.css);</style>

    </tal:block>
</head>

<body bottommargin="0" leftmargin="0" marginheight="0" marginwidth="0" rightmargin="0" topmargin="0">

<metal:main>
    <tal:main-macro metal:define-macro="main"
           tal:define="kssClassesView context/@@kss_field_decorator_view;
                       getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                       templateId template/getId;
                       fullDescription here/getFullDescription;">
		<div class="roundborder rounded" tal:define="original_url python:here.absolute_url();
                                                     portal context/@@plone_portal_state/portal">

          <div id="video-core" tal:define="transcoded python:view.transcoding('mp4');
                                     webm python:view.transcoding('webm-high').replace('+','%2B'); 
                                     mp4 python:view.transcoding('mp4-high').replace('+','%2B'); 
                                     thumb python:view.hasThumbnailImage() and here.absolute_url()+'/thumbnailImage_mini' or '';
                                     fullThumb python:view.hasThumbnailImage() and here.absolute_url()+'/thumbnailImage' or ''">

              <video controls width="525" height="300" tal:attributes="poster string:${here/absolute_url}/thumbnailImage" controls="controls" preload="none">
                <source tal:condition="mp4" tal:attributes="src mp4" type="video/mp4" />               
                <source tal:condition="webm" tal:attributes="src webm" type="video/webm" />
                <object width="525" height="300" type="application/x-shockwave-flash" data="++resource++collective.mediaelementjs/flashmediaelement.swf">
                    <param name="movie" value="++resource++collective.mediaelementjs/flashmediaelement.swf" />
                    <param name="flashvars" tal:attributes="value string:controls=true&poster=${thumb}&file=${mp4}" />       
                    <!-- Image as a last resort -->
                    <img tal:attributes="src thumb" width="525" height="300" title="No video playback capabilities" />
                </object>
             </video>
          </div> <!-- id=video-core -->      
	</div>
        <script language="javascript">
           var player = new MediaElementPlayer('video');
        </script>

    </tal:main-macro>
</metal:main>
</body>
</html>

