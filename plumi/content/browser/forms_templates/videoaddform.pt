<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="example.dexterityforms"
      metal:use-macro="context/main_template/macros/master">
      
    <metal:block fill-slot="main">
        
        <h1 class="documentFirstHeading" tal:content="view/label | nothing" />
                
        <div id="content-core">
            <div id="uploader">
                <div id="multipleupload-code">
                    <script>var $_original = jQuery.noConflict();</script>
                    <script src="jsvariables" type="text/javascript"></script>
                    <script src="++resource++collective.upload/jquery.1.7.1.js"></script>
                    <script>var j$ = $; $ = $_original; jQuery = $_original;</script>
                    <!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
                    <script src="++resource++collective.upload/jquery.ui.widget.js"></script>
                    <!-- The Load Image plugin is included for the preview images and image resizing functionality -->
                    <script src="++resource++collective.upload/load-image.min.js"></script>
                    <!-- The Canvas to Blob plugin is included for image resizing functionality -->
                    <script src="++resource++collective.upload/canvas-to-blob.min.js"></script>
                    <script src="++resource++collective.upload/jquery.iframe-transport.js"></script>
                    <script src="++resource++collective.upload/jquery.fileupload.js"></script>
                    <!-- The File Upload image processing plugin -->
                    <script src="++resource++collective.upload/jquery.fileupload-ip.js"></script>
                    <script src="++resource++collective.upload/jquery.fileupload-ui.js"></script>
                    <script src="++resource++collective.upload/media-upload-init-behavior.js"></script>
                </div>
                <link rel="stylesheet" type="text/css" media="screen" href="++resource++plumi.content.stylesheets/publish.css" />
                <div id="upload-form-top">
                    <form id="fileupload" action="." tal:attributes="action string:${context/absolute_url}/plumi_uploader" method="POST"
                    enctype="multipart/form-data">
                        <div class="row">
                            <div class="cell position-0 width-full fileupload-buttonbar">
                                <div class="controls">
                                    <span class="btn success fileinput-button progressbar">
                                        <span i18n:translate="">Add a video file</span>
                                        <input type="file" name="files[]" size="50" />
                                        <div style="width:0%;"></div>
                                    </span>
                                    <button type="reset" class="btn cancel" style="display: none">
                                        <span class="" i18n:translate="">Cancel upload</span>
                                    </button>
                                    <button type="reset" class="btn danger delete" style="display: none">
                                        <span class="" i18n:translate="">Delete selected</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>    
            </div>
            <div class="row">
                <metal:block use-macro="context/@@ploneform-macros/titlelessform" />
            </div>
            <script language="javascript">
                // perform JavaScript after the document is scriptable.
                
                j$('#fileupload').fileupload({ 
                    maxNumberOfFiles: 1,
                    autoUpload: true, 
                    
                    progress: function (e, data) {
                        $('.fileinput-button div').attr('style','width:' + 100*(data.loaded/data.total) + '%');
                    },
                    
                    done: function (e, data) {
                        $('button.cancel').hide();
                        $('button.delete').show();
                        $.each(data.files, function (index, file) {
                            $('.fileinput-button span').text(file.name + ' - ' + file.size);
                            $('.fileinput-button span').addClass('left');
                        });
                    },
                    
                    send: function (e,data) {
                        $('.fileinput-button span').text('Uploading ' + data.files[0].name);
                        $('button.cancel').show();
                    },
                    
                    destroy: function (e,data) {
                        alert('hi');
                    }
                }); 
                
            </script>
        </div>
        
    </metal:block>
    
</html>
